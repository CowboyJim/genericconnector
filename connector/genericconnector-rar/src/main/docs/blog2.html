<html>
<head>
    <script src="run_prettify.js"></script>
    <style type="text/css">
    body {
        font-size: 16px;
        font-weight: 300;
        font-family: ProximaNova, helvetica, arial;
        line-height: 150%;
    }
    </style>
</head>
<body>
    
<h2>
Global Data Consistency, Microservices and Spring Boot
</h2>
Ant Kutschera, 201509
<br/>
<br/>

You will often build services which need to make several calls to several (micro-) services, or write to a database and call a microservice.  But what happens if there is an 
error during a call to one of the services, or if the database commit fails, after you have called a service?  If a service call ends up writing data, you could end up with 
a globally inconsistent state.  You will need to compensate for that, and typically that compensation is something that is hand written and complex.<br/>
<br/>
In a 
<a href='http://blog.maxant.co.uk/pebble/2015/08/04/1438716480000.html' target='_blank'>recent article</a>
I wrote about how I have built a generic JCA connector which allows you to bind things like calls to microservices into global distributed transactions under the control
of Java EE application servers, precisely so that you don't have to write your own framework code for handling failures during distributed transactions.  The connector takes
care of ensuring that your data is eventually consistent.<br/>
<br/>
I have now extended the library to include automatic handling of commit / rollback / recovery into <b>Tomcat</b> or <b>Spring Boot</b> applications.<br/>
<br/>
Arun Gupta of Red Hat writes about different microservice patterns in the
<a href='https://dzone.com/servlet/storage/?file=293353' target='_blank'>DZone Getting Started with Microservices Refcard</a>.
Indeed the majority of those patterns show a microservice calling multiple other microservices. In all these cases, global data consistency becomes relevant, i.e. ensuring
that failure in one of the latter calls to a microservice is either compensated, or the commital of the call is re-attempted, until all the data in all the microservices 
is again consistent.
<br/>
<br/>


standalone demo:
https://github.com/maxant/genericconnector/blob/master/demo/genericconnector-demo-bitronix/src/main/java/ch/maxant/generic_jca_adapter/Main.java



The first step in making sure your data remain eventually consistent is to add a transaction manager to your composite service. I have chosen to use 
<a href='https://github.com/bitronix/btm' target="_blank">Bitronix</a> because it can be used with Tomcat and Spring.  Examples of how to integrate my library 
with Spring Boot can be found
<a href='https://github.com/maxant/genericconnector/blob/master/demo/genericconnector-demo-springboot-bitronix/src/main/java/ch/maxant/generic_jca_adapter/DemoSpringBootApplication.java' target='_blank'>here, for a standalone application</a>, or
<a href='https://github.com/maxant/genericconnector/blob/master/demo/genericconnector-demo-springboot-bitronix/src/main/java/ch/maxant/generic_jca_adapter/DemoSpringBootServer.java' target='_blank'>here, for a standalone microservice</a>.
An example of integrating with Tomcat 
https://github.com/maxant/genericconnector/tree/master/demo/genericconnector-demo-tomcat-bitronix

lack of docs:
https://github.com/bitronix/btm/issues/51





http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-jta.html

https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples/spring-boot-sample-jta-bitronix
https://github.com/spring-projects/spring-boot/tree/master/spring-boot-starters/spring-boot-starter-jta-bitronix

http://bitronix-transaction-manager.10986.n7.nabble.com/tomcat-7-0-26-and-bitronix-td1155.html

Here are some links for Getting Bitronix to work with Spring, Spring Boot or 
Tomcat is mostly a matter of ocnfiguration, for example 










getting it to run (readme.md):

context.xml is in meta-inf and has transaction defined


-Dbitronix.tm.configuration="/t/apache-tomcat-8.0.26-bitronix/bin/bitronix-default-config.properties"









            //example of configuring the transaction assistance component:
            MicroserviceXAResource.configure(30000L, new File("."));




<br/>
Copyright &copy;2015, Ant Kutschera.







</body>
</html>


<hr>
------------------------------------------------------------------------------

    //TODO http://www.contino.co.uk/microservices-not-a-free-lunch/
    //TODO branch 2.1.0 => update numbers
    //TODO publish version 2.1.0 with maven deploy
    //TODO update version number to 2.1.1-SNAPSHOT
    //TODO http://arxiv.org/pdf/1509.05393v2.pdf
    //TODO integration tests for spring-boot?
    //TODO update ALL readme.md
    //TODO write new blog
    //TODO test recovery if crashed on DB
    //TODO update old blog to refer to new blog
    //TODO publish also on twitter
    

------------------------------------------------------------------------------
http://lanyrd.com/topics/microservices/
------------------------------------------------------------------------------
http://microxchg.io/2016/index.html (February)
Submitted 201509251110
ant@maxant.co.uk
---
"Global Data Consistency in Microservice Architectures":

Based on the speakers experience of building (micro-)service based architectures, it is paramount that data remains consistent in the entire system, whether it is through traditional ACID guarantees, or eventual consistency.  While technologies like WS-AT and Remote EJB allow for controlling data consistency across remote calls, they have not been regularly adopted in the fight to manage data consistency in architectures where remote calls are standard.  Indeed the speaker has noted a number of systems where consistency has either been entirely disregarded or where complex custom frameworks akin to transaction managers have been built, at a considerable cost.

In a bid to reduce complexity and cost but strive for guaranteed eventual consistency, the speaker has developed a library capable of managing data consistency across remote calls, automatically, based on Java JTA specifications.

The author would like to talk about the problems of global data consistency in microservice architectures and present his solution at this conference.  The solution is compatible with: Spring Boot, Spring+Tomcat, Spring+Jetty, Java EE application servers and standalone Java applications.

See http://blog.maxant.co.uk/pebble/2015/08/04/1438716480000.html for a technical introduction which only discusses Java EE.  There is an upcoming article dedicated towards other technologies like Spring Boot.
---
Ant Kutschera works with large enterprises as a senior freelance software developer and architect through his company Organit, in Berne, Switzerland. He has over 15 years experience of Java and Java EE, but has also worked on projects based on Scala and Node JS.  Ant has been writing his blog since 2005 which now has over 100 technical articles. He has also written a book about how to use Scala to build applications which run on the Java EE platform (https://www.createspace.com/4228776). Ant has presented at conferences and forums in Berne, but also many many years ago in the USA while doing his PhD.
---
Ich könnte dieses Gespräch auch in Deutsch führen, wenns Euch lieber wäre.
------------------------------------------------------------------------------
QCon 2016 London (March)
http://qconlondon.com/talk-submissions
https://docs.google.com/forms/d/1TKkIO_nYMpHkH2QXRXsxZXpJANubF0B2R8FyknMgIYs/viewform
Submitted 201509251120
---
Global Data Consistency in Microservice Architectures
---
Based on the speakers experience of building (micro-)service based architectures, it is paramount that data remains consistent in the entire system, whether it is through traditional ACID guarantees, or eventual consistency.  While technologies like WS-AT and Remote EJB allow for controlling data consistency across remote calls, they have not been regularly adopted in the fight to manage data consistency in architectures where remote calls are standard.  Indeed the speaker has noted a number of systems where consistency has either been entirely disregarded or where complex custom frameworks akin to transaction managers have been built, at a considerable cost.

In a bid to reduce complexity and cost but strive for guaranteed eventual consistency, the speaker has developed a library capable of managing data consistency across remote calls, automatically, based on Java JTA specifications.

The author would like to talk about the problems of global data consistency in microservice architectures and present his solution at this conference.  The solution is compatible with: Spring Boot, Spring+Tomcat, Spring+Jetty, Java EE application servers and standalone Java applications.

See http://blog.maxant.co.uk/pebble/2015/08/04/1438716480000.html for a technical introduction which only discusses Java EE.  There is an upcoming article dedicated towards other technologies like Spring Boot.
---
Ant Kutschera; ant@maxant.co.uk
---
Ant Kutschera works with large enterprises as a senior freelance software developer and architect through his company Organit, in Berne, Switzerland. He has over 15 years experience of Java and Java EE, but has also worked on projects based on Scala and Node JS.  Ant has been writing his blog since 2005 which now has over 100 technical articles. He has also written a book about how to use Scala to build applications which run on the Java EE platform (https://www.createspace.com/4228776). Ant has presented at conferences and forums in Berne, but also many many years ago in the USA while doing his PhD.
---
Platform: Java
---
Attendees will learn about how to incorporate global transaction management into their Java solutions, so that data consistency and compensation in the case of failure is handled automatically. By basing their solutions on the presented open source library, they will reduce cost and complexity while increasing system reliability and robustness.

This talk might well work better in one of the tutorial sessions where I can help attendees build demo applications and show them how to test their solutions.
------------------------------------------------------------------------------
apply? https://voxxeddays.com/berlin16/
